<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Complaint List</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0b0c0f;
      --panel: #0f1720;
      --card: #0f1724;
      --muted: #9fb0d9;
      --accent: #6b8cff;
      --row-hover: rgba(107,140,255,0.06);
      --border: #1b2230;
      --text: #eef6ff;
      --subtle: #c9d8ff;
    }

    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg,#06070a 0%, var(--bg) 100%);
      color:var(--text);
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container {
      padding-top:48px;
      padding-bottom:48px;
      max-width:980px;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--border);
      border-radius:12px;
      overflow:hidden;
      box-shadow: 0 6px 24px rgba(2,6,23,0.6);
    }

    .card-header {
      background: linear-gradient(90deg, rgba(107,140,255,0.06), transparent);
      border-bottom:1px solid rgba(255,255,255,0.02);
      padding:18px 20px;
    }

    h5 {
      margin:0;
      font-weight:700;
      color:var(--text);
      letter-spacing: -0.2px;
    }

    .small-muted {
      color: var(--muted);
      font-size:0.86rem;
      margin-top:4px;
    }

    .pill {
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,0.02);
      color:var(--subtle);
      font-size:0.82rem;
      border:1px solid rgba(255,255,255,0.03);
      font-weight:600;
    }

    .table-wrap {
      padding: 12px 18px 20px 18px;
    }

    .table {
      color:var(--text);
      border-collapse: separate;
      border-spacing: 0 10px;
      width:100%;
    }

    thead th {
      color: var(--muted);
      font-weight:700;
      font-size:0.85rem;
      text-transform:uppercase;
      letter-spacing:0.6px;
      border-bottom: none;
      padding: 12px 16px;
      background: transparent;
    }

    tbody tr {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border-radius:10px;
      transition: background .12s ease, transform .06s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset;
    }

    tbody tr:hover {
      background: var(--row-hover);
      transform: translateY(-2px);
    }

    .table td {
      vertical-align: middle;
      border-top: 0;
      padding: 14px 16px;
      color: var(--text);
      font-size:0.95rem;
      background: transparent;
    }

    .name-strong {
      font-weight:700;
      color: #ffffff;
      font-size:0.98rem;
    }

    .meta-muted {
      color: var(--muted);
      font-size:0.82rem;
      margin-top:4px;
    }

    .reason-cell {
      max-width:420px;
      white-space:pre-wrap;
      word-break:break-word;
      color: #f3f7ff;
      opacity:0.95;
    }

    .date-cell {
      text-align:right;
      color: var(--muted);
      font-size:0.85rem;
      white-space:nowrap;
    }

    .empty-state {
      padding:36px;
      text-align:center;
      color:var(--muted);
    }

    /* Responsive: stack rows on small screens */
    @media (max-width:720px){
      .table thead { display:none; }
      .table, .table tbody, .table tr, .table td { display:block; width:100%; }
      .table tr { margin-bottom:12px; border-radius:8px; padding:12px; background: rgba(255,255,255,0.01); }
      .table td { padding:8px 0; border-top:0; }
      .table td .label { display:block; font-weight:700; color:var(--muted); margin-bottom:6px; font-size:0.78rem; }
      .date-cell { text-align:left; margin-top:6px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="card-header d-flex align-items-center justify-content-between">
        <div>
          <h5>Complaint List</h5>
          <div class="small-muted">All complaints submitted by users</div>
        </div>
        <div class="text-end">
          <span class="pill" id="totalCount">0 complaints</span>
        </div>
      </div>

      <div class="table-wrap">
        <div class="table-responsive">
          <table class="table" aria-describedby="Complaint List">
            <thead>
              <tr>
                <th style="width:18%;">Name</th>
                <th style="width:14%;">Subject Code</th>
                <th style="width:22%;">Subject Name</th>
                <th style="width:36%;">Reason</th>
                <th style="width:10%;">Submitted</th>
              </tr>
            </thead>
            <tbody id="complaintTable"></tbody>
          </table>
        </div>

        <div id="emptyState" class="empty-state d-none">
          <div style="font-size:1.05rem;font-weight:700;color:var(--subtle)">No complaints yet</div>
          <div class="small-muted mt-2">When users submit complaints they will appear here.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Escape HTML to avoid injection
    function escapeHtml(str) {
      if (str === null || str === undefined) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    // Load complaints from either admin key or legacy key
    function loadComplaints() {
      const keys = ['notes_complaints_v1', 'complaints'];
      for (const k of keys) {
        const raw = localStorage.getItem(k);
        if (!raw) continue;
        try {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) return parsed;
        } catch (e) {
          // ignore parse errors
        }
      }
      return [];
    }

    function formatDate(iso) {
      try {
        const d = new Date(iso || Date.now());
        if (isNaN(d.getTime())) return '—';
        return d.toLocaleString();
      } catch (e) {
        return '—';
      }
    }

    (function render() {
      const complaints = loadComplaints();
      const tbody = document.getElementById('complaintTable');
      const empty = document.getElementById('emptyState');
      const total = document.getElementById('totalCount');

      tbody.innerHTML = '';

      if (!complaints.length) {
        empty.classList.remove('d-none');
        total.textContent = '0 complaints';
        return;
      }
      empty.classList.add('d-none');
      total.textContent = complaints.length + (complaints.length === 1 ? ' complaint' : ' complaints');

      complaints.forEach(c => {
        const name = c.name || c.reporter || 'Anonymous';
        const subjectCode = c.subjectCode || c.subCode || '—';
        const subjectName = c.subjectName || c.subName || '—';
        const reason = c.reason || c.message || '—';
        const createdAt = c.createdAt || c.created || null;

        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>
            <div class="name-strong">${escapeHtml(name)}</div>
            <div class="meta-muted">${escapeHtml(subjectCode)}</div>
          </td>
          <td>
            <div class="meta-muted">${escapeHtml(subjectCode)}</div>
          </td>
          <td>
            <div>${escapeHtml(subjectName)}</div>
          </td>
          <td class="reason-cell">${escapeHtml(reason)}</td>
          <td class="date-cell">${escapeHtml(formatDate(createdAt))}</td>
        `;

        tbody.appendChild(tr);
      });
    })();
  </script>
</body>
</html>
